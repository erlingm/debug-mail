<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<title>howto.html</title>

		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
		<meta http-equiv="description" content="this is my page">
		<meta http-equiv="content-type"
			content="text/html; charset=ISO-8859-1">
		<link rel="stylesheet" type="text/css" href="./styles.css">

	</head>

	<body>
		<h1> 
			debugMail HOWTO 
		</h1>
		<p>
			Ved &aring; plassere jar-fila som inneholder denne koden i classpath
			for f.eks. Tomcat, vil e-post som sendes ut fra applikasjonene bli
			rutet slik at de ikke g&aring;r til de av applikasjonen oppsatte
			mottager-adressene, men blir lagret i en fil i en lokal mappe. Hver
			applikasjon kan ha sitt eget oppsett, men biblioteket m&aring;
			v&aelig;re felles for alle applikasjoner, dette skyldes at
			bibliotekets navn initieres f&oslash;r applikasjonene initialiseres
			(dette gjelder for Tomcat, og muligens ogs&aring; for andre servlet
			containere).
		</p>
		<h2>
			Meldingslager
		</h2>
		<p>
			Meldinger lagres i en mappe, hver melding lagres i sin egen fil. Hvor
			mappa skal ligge, er en konfigurerbar innstilling.
		</p>
		<p>
			Biblioteket leter etter en
			<cite>property</cite> med navnet
			<strong>infored.mailfolder</strong> p&aring; f&oslash;lgende steder,
			og i denne rekkef&oslash;lgen, og kravet for at verdien skal regnes
			som funnet, er at mappen som
			<cite>property</cite>en peker p&aring;, er tilgjengelig og skrivbar:
		</p>
		<ol>
			<li>
				Session properties (
				<code>
					javax.mail.Session
				</code>
				)
			</li>
			<li>
				System properties (
				<code>
					java.lang.System
				</code>
				)
			</li>
			<li>
				Property-fila
				<code>
					infored.mailfolder.properties
				</code>
				i classpath for gjeldende eksekveringstr&aring;ds classloader.
			</li>
		</ol>
		<p>
			Hvis ikke dette f&oslash;rer fram, fors&oslash;ker biblioteket
			&aring; lese
			<cite>System property</cite>
			<code>
				java.io.tmpdir
			</code>
			og etablere en skrivbar mappe kalt
			<code>
				mailSaved
			</code>
			ved siden av denne mappen. Hvis heller ikke dette f&oslash;rer fram,
			benyttes mappen angitt av
			<cite>System property</cite>
			<code>
				java.io.tmpdir
			</code>
			direkte som lagringssted for filene.
			<br>
		</p>
		<h2>
			Regler
		</h2>
		<p>
			Regler for behandling av adresser kan p&aring;virkes gjennom to
			<cite>property</cite> innstillinger i
			<cite>property</cite>-fila
			<code>
				debugMail.properties
			</code>
			.
		</p>
		<p>
			De to property-settingene er:
		</p>
		<dl compact="compact">
			<dt>
				allow=
			</dt>
			<dd>
				Her skal det stå en komma-separert liste over
				<cite>regex</cite>-uttrykk som angir lovlige adresser fra
				applikasjonen, dvs. adresser som matcher en eller flere av disse
				reglene, blir sendt til disse adressene. Regex-uttrykkene m&aring;
				tilfredsstille hele adressen for &aring; gi samsvar (metoden
				<code>
					java.util.regex.Matcher.matches()
				</code>
				blir benyttet i kontrollen).
			</dd>
			<dt>
				replace=
			</dt>
			<dd>
				<p>
					Her kan man skrive inn en komma-separert liste over adresser som
					skal motta meldingen
					<em>i tillegg til</em> de adressene som tilfredsstiller
					<cite>allow</cite>-reglene.
				</p>
				<p>
					Hver adresse kan være en ren internett-adresse, eller en kombinert
					fritekst og internett-adresse adskilt med
					<cite>bar</cite>-tegn.
					<br>
					Eksempel:
					<br>
					replace=erling.molde@gmail.com, Erling fra
					InfoRed|erling.molde@infored.no, \
					<br>
					&nbsp;&nbsp;&nbsp; Erling privat|erling.molde@online.no
					<br>
				</p>
			</dd>
		</dl>
		<p>
			Biblioteket s&oslash;rger for at hver adresse bare blir brukt en
			gang, selv om adressen slipper gjennom flere ganger, f.eks.
			b&aring;de via
			<cite>allow</cite> og via
			<cite>replace</cite>.
		</p>
		<p>
			Dersom
			<code>
				debugMail.properties
			</code>
			ikke kan lokaliseres, eller ikke inneholder gyldige regler &ndash;
			<cite>allow</cite> og/eller
			<cite>replace</cite>, blir ingen meldinger sendt.
		</p>
	</body>
</html>
